<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Image Generator</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f9fafb;
            color: #111827;
        }
        
        .hidden { display: none !important; }
        
        .gradient-bg {
            background: linear-gradient(135deg, #7c3aed, #3b82f6, #4338ca);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            padding: 2rem;
            width: 100%;
            max-width: 28rem;
        }
        
        .header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .icon-large {
            width: 4rem;
            height: 4rem;
            background: linear-gradient(135deg, #7c3aed, #3b82f6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 2rem;
        }
        
        .title {
            font-size: 1.875rem;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        
        .subtitle {
            color: #6b7280;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        
        .input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: all 0.2s;
        }
        
        .input:focus {
            outline: none;
            ring: 2px;
            ring-color: #7c3aed;
            border-color: transparent;
        }
        
        .textarea {
            resize: none;
            font-family: inherit;
        }
        
        .btn {
            width: 100%;
            padding: 0.75rem 1rem;
            background: linear-gradient(135deg, #7c3aed, #3b82f6);
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .btn:hover {
            background: linear-gradient(135deg, #6d28d9, #2563eb);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-large {
            padding: 1rem 1.5rem;
            font-size: 1.125rem;
        }
        
        .error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .success {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            color: #0369a1;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
        }
        
        .link-btn {
            background: none;
            border: none;
            color: #7c3aed;
            cursor: pointer;
            font-weight: 500;
            text-decoration: underline;
        }
        
        .link-btn:hover {
            color: #6d28d9;
        }
        
        .main-layout {
            min-height: 100vh;
            display: flex;
        }
        
        .sidebar {
            width: 20rem;
            background: white;
            border-right: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
        }
        
        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .sidebar-profile {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .icon-small {
            width: 2.5rem;
            height: 2.5rem;
            background: linear-gradient(135deg, #7c3aed, #3b82f6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
        }
        
        .user-info h3 {
            font-weight: bold;
            color: #1f2937;
        }
        
        .user-info p {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .nav-tabs {
            display: flex;
            gap: 0.5rem;
        }
        
        .nav-tab {
            flex: 1;
            padding: 0.5rem 0.75rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .nav-tab.active {
            background: #f3f4f6;
            color: #7c3aed;
        }
        
        .nav-tab:not(.active) {
            color: #6b7280;
        }
        
        .nav-tab:not(.active):hover {
            background: #f9fafb;
        }
        
        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }
        
        .sidebar-footer {
            padding: 1rem;
            border-top: 1px solid #e5e7eb;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .content-area {
            flex: 1;
            padding: 2rem;
        }
        
        .content-center {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100%;
        }
        
        .content-card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            width: 100%;
            max-width: 64rem;
        }
        
        .content-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .content-title {
            font-size: 1.875rem;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 1rem;
        }
        
        .history-item {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .history-header {
            margin-bottom: 1rem;
        }
        
        .history-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        
        .history-date {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }
        
        .image-card {
            text-align: center;
        }
        
        .image-label {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            font-weight: 500;
            color: #374151;
        }
        
        .status-dot {
            width: 0.75rem;
            height: 0.75rem;
            border-radius: 50%;
        }
        
        .status-dalle { background: #ef4444; }
        .status-stable { background: #10b981; }
        .status-midjourney { background: #3b82f6; }
        
        .image-preview {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .image-preview:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.2);
        }
        
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.75);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            z-index: 50;
        }
        
        .modal-content {
            position: relative;
            max-width: 64rem;
            max-height: 100%;
        }
        
        .modal-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 0.5rem;
        }
        
        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: white;
            color: #1f2937;
            padding: 0.5rem;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 1.25rem;
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-close:hover {
            background: #f3f4f6;
        }
        
        .empty-state {
            text-align: center;
            padding: 4rem 1rem;
        }
        
        .empty-icon {
            font-size: 4rem;
            color: #d1d5db;
            margin-bottom: 1rem;
        }
        
        .empty-title {
            font-size: 1.25rem;
            font-weight: 500;
            color: #6b7280;
            margin-bottom: 0.5rem;
        }
        
        .empty-text {
            color: #9ca3af;
            margin-bottom: 1.5rem;
        }
        
        .history-sidebar-item {
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .history-sidebar-item:hover {
            background: #f9fafb;
        }
        
        .history-sidebar-title {
            font-size: 0.875rem;
            color: #1f2937;
            margin-bottom: 0.25rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .history-sidebar-date {
            font-size: 0.75rem;
            color: #6b7280;
        }
        
        .spinning {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                position: fixed;
                top: 0;
                left: -100%;
                height: 100vh;
                z-index: 40;
                transition: left 0.3s;
            }
            
            .sidebar.open {
                left: 0;
            }
            
            .main-content {
                width: 100%;
            }
            
            .image-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Auth Page -->
    <div id="auth-page" class="gradient-bg">
        <div class="card">
            <div class="header">
                <div class="icon-large">‚ú®</div>
                <h1 class="title">AI Image Generator</h1>
                <p class="subtitle">Comparez DALL-E, Stable Diffusion et Midjourney</p>
            </div>

            <div class="form-group">
                <label class="label">Email</label>
                <input type="email" id="email" class="input" placeholder="votre@email.com" required>
            </div>

            <div class="form-group">
                <label class="label">Mot de passe</label>
                <input type="password" id="password" class="input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
            </div>

            <div id="auth-error" class="hidden error"></div>

            <button id="auth-btn" class="btn">
                <span id="auth-text">Se connecter</span>
                <span id="auth-loader" class="hidden spinning">‚è≥</span>
            </button>

            <div style="margin-top: 1.5rem; text-align: center;">
                <button id="toggle-auth" class="link-btn">Cr√©er un compte</button>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="main-app" class="hidden main-layout">
        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Header -->
            <div class="sidebar-header">
                <div class="sidebar-profile">
                    <div class="icon-small">‚ú®</div>
                    <div class="user-info">
                        <h3>AI Generator</h3>
                        <p id="user-email"></p>
                    </div>
                </div>
                
                <div class="nav-tabs">
                    <button id="nav-generate" class="nav-tab active">
                        üí¨ G√©n√©rer
                    </button>
                    <button id="nav-history" class="nav-tab">
                        üìã Historique
                    </button>
                </div>
            </div>

            <!-- History List -->
            <div class="sidebar-content">
                <h3 style="font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.75rem;">G√©n√©rations r√©centes</h3>
                <div id="sidebar-history">
                    <!-- History items will be inserted here -->
                </div>
            </div>

            <!-- Footer -->
            <div class="sidebar-footer">
                <button id="logout-btn" class="btn">
                    üö™ Se d√©connecter
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Generate View -->
            <div id="generate-view" class="content-area">
                <div class="content-center">
                    <div class="content-card">
                        <div class="content-header">
                            <h2 class="content-title">G√©n√©rez des images avec 3 IA</h2>
                            <p class="subtitle">Comparez DALL-E 3, Stable Diffusion XL et Midjourney en un clic</p>
                        </div>

                        <div class="form-group">
                            <label class="label">D√©crivez l'image que vous voulez g√©n√©rer</label>
                            <textarea id="prompt-input" class="input textarea" rows="4" placeholder="Ex: Un chat astronaute sur la lune en style cartoon, tr√®s d√©taill√©, couleurs vives..."></textarea>
                        </div>

                        <button id="generate-btn" class="btn btn-large">
                            <span id="generate-icon">‚ú®</span>
                            <span id="generate-text">G√©n√©rer avec 3 IA</span>
                        </button>

                        <div id="generate-error" class="hidden error"></div>

                        <div id="generate-progress" class="hidden success">
                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                <span class="spinning">‚è≥</span>
                                <span style="font-weight: 500;">G√©n√©ration en cours...</span>
                            </div>
                            <p style="margin-top: 0.5rem; font-size: 0.875rem;">DALL-E 3, Stable Diffusion XL et Midjourney travaillent sur votre prompt</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- History View -->
            <div id="history-view" class="hidden content-area">
                <div style="margin-bottom: 2rem;">
                    <h2 class="content-title">Historique des g√©n√©rations</h2>
                    <p class="subtitle">Toutes vos cr√©ations AI en un coup d'≈ìil</p>
                </div>

                <div id="history-content">
                    <!-- History items will be inserted here -->
                </div>

                <div id="empty-history" class="hidden empty-state">
                    <div class="empty-icon">üñºÔ∏è</div>
                    <h3 class="empty-title">Aucune g√©n√©ration</h3>
                    <p class="empty-text">Commencez par g√©n√©rer votre premi√®re image</p>
                    <button id="start-generate" class="btn">G√©n√©rer une image</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Modal -->
    <div id="image-modal" class="hidden modal">
        <div class="modal-content">
            <img id="modal-image" class="modal-image">
            <button id="close-modal" class="modal-close">‚úï</button>
        </div>
    </div>

    <script>
        // Configuration
        const N8N_WEBHOOK_URL = "https://danytherrien.app.n8n.cloud/webhook/generate-images";
        
        // State
        let currentUser = null;
        let authMode = 'login';
        let currentView = 'generate';
        let generationHistory = [];

        // DOM Elements
        const authPage = document.getElementById('auth-page');
        const mainApp = document.getElementById('main-app');
        const authBtn = document.getElementById('auth-btn');
        const authText = document.getElementById('auth-text');
        const authLoader = document.getElementById('auth-loader');
        const authError = document.getElementById('auth-error');
        const toggleAuth = document.getElementById('toggle-auth');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const userEmailSpan = document.getElementById('user-email');
        const generateView = document.getElementById('generate-view');
        const historyView = document.getElementById('history-view');
        const navGenerate = document.getElementById('nav-generate');
        const navHistory = document.getElementById('nav-history');
        const promptInput = document.getElementById('prompt-input');
        const generateBtn = document.getElementById('generate-btn');
        const generateIcon = document.getElementById('generate-icon');
        const generateText = document.getElementById('generate-text');
        const generateError = document.getElementById('generate-error');
        const generateProgress = document.getElementById('generate-progress');
        const historyContent = document.getElementById('history-content');
        const emptyHistory = document.getElementById('empty-history');
        const sidebarHistory = document.getElementById('sidebar-history');
        const imageModal = document.getElementById('image-modal');
        const modalImage = document.getElementById('modal-image');
        const closeModal = document.getElementById('close-modal');
        const logoutBtn = document.getElementById('logout-btn');
        const startGenerate = document.getElementById('start-generate');

        // Event Listeners
        authBtn.addEventListener('click', handleAuth);
        toggleAuth.addEventListener('click', toggleAuthMode);
        navGenerate.addEventListener('click', () => switchView('generate'));
        navHistory.addEventListener('click', () => switchView('history'));
        generateBtn.addEventListener('click', handleGenerate);
        logoutBtn.addEventListener('click', handleLogout);
        startGenerate.addEventListener('click', () => switchView('generate'));
        closeModal.addEventListener('click', () => imageModal.classList.add('hidden'));

        // Functions
        function toggleAuthMode() {
            authMode = authMode === 'login' ? 'register' : 'login';
            authText.textContent = authMode === 'login' ? 'Se connecter' : 'S\'inscrire';
            toggleAuth.textContent = authMode === 'login' ? 'Cr√©er un compte' : 'D√©j√† un compte ? Se connecter';
        }

        async function handleAuth() {
            const email = emailInput.value.trim();
            const password = passwordInput.value;

            if (!email || !password) {
                showError('Veuillez remplir tous les champs');
                return;
            }

            if (authMode === 'register' && password.length < 6) {
                showError('Le mot de passe doit contenir au moins 6 caract√®res');
                return;
            }

            setLoading(true);
            hideError();

            try {
                // Simulate auth
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                currentUser = {
                    email: email,
                    uid: email.replace('@', '_').replace('.', '_')
                };

                userEmailSpan.textContent = email;
                authPage.classList.add('hidden');
                mainApp.classList.remove('hidden');
                loadHistory();
                
            } catch (error) {
                showError('Erreur de connexion');
            } finally {
                setLoading(false);
            }
        }

        function setLoading(loading) {
            if (loading) {
                authLoader.classList.remove('hidden');
                authText.textContent = 'Connexion...';
                authBtn.disabled = true;
            } else {
                authLoader.classList.add('hidden');
                authText.textContent = authMode === 'login' ? 'Se connecter' : 'S\'inscrire';
                authBtn.disabled = false;
            }
        }

        function showError(message) {
            authError.textContent = message;
            authError.classList.remove('hidden');
        }

        function hideError() {
            authError.classList.add('hidden');
        }

        function switchView(view) {
            currentView = view;
            
            if (view === 'generate') {
                generateView.classList.remove('hidden');
                historyView.classList.add('hidden');
                navGenerate.classList.add('active');
                navHistory.classList.remove('active');
            } else {
                generateView.classList.add('hidden');
                historyView.classList.remove('hidden');
                navGenerate.classList.remove('active');
                navHistory.classList.add('active');
            }
        }

        async function handleGenerate() {
            const prompt = promptInput.value.trim();
            if (!prompt) return;

            setGenerating(true);
            hideGenerateError();

            try {
                const response = await fetch(N8N_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        prompt: prompt,
                        email: currentUser.email
                    })
                });

                let result;
                if (response.ok) {
                    result = await response.json();
                } else {
                    throw new Error('Erreur r√©seau');
                }

                const newGeneration = {
                    id: Date.now().toString(),
                    prompt: prompt,
                    dalle_url: result.dalle_url || `https://via.placeholder.com/512x512/ef4444/white?text=${encodeURIComponent('DALL-E: ' + prompt.slice(0, 20))}`,
                    stable_url: result.stable_url || `https://via.placeholder.com/512x512/10b981/white?text=${encodeURIComponent('SD: ' + prompt.slice(0, 20))}`,
                    midjourney_url: result.midjourney_url || `https://via.placeholder.com/512x512/3b82f6/white?text=${encodeURIComponent('MJ: ' + prompt.slice(0, 20))}`,
                    dalle_status: result.dalle_status || "success",
                    stable_status: result.stable_status || "success",
                    midjourney_status: result.midjourney_status || "success",
                    timestamp: new Date(),
                    userId: currentUser.uid
                };

                generationHistory.unshift(newGeneration);
                promptInput.value = '';
                updateHistory();
                switchView('history');

            } catch (error) {
                console.error('Erreur g√©n√©ration:', error);
                showGenerateError('Erreur lors de la g√©n√©ration. Mode d√©mo activ√©.');
                
                // Fallback demo
                const fallbackGeneration = {
                    id: Date.now().toString(),
                    prompt: prompt,
                    dalle_url: `https://via.placeholder.com/512x512/ef4444/white?text=${encodeURIComponent('DALL-E: ' + prompt.slice(0, 20))}`,
                    stable_url: `https://via.placeholder.com/512x512/10b981/white?text=${encodeURIComponent('SD: ' + prompt.slice(0, 20))}`,
                    midjourney_url: `https://via.placeholder.com/512x512/3b82f6/white?text=${encodeURIComponent('MJ: ' + prompt.slice(0, 20))}`,
                    dalle_status: "demo",
                    stable_status: "demo",
                    midjourney_status: "demo",
                    timestamp: new Date(),
                    userId: currentUser.uid
                };

                generationHistory.unshift(fallbackGeneration);
                promptInput.value = '';
                updateHistory();
                switchView('history');
            } finally {
                setGenerating(false);
            }
        }

        function setGenerating(generating) {
            if (generating) {
                generateIcon.textContent = '‚è≥';
                generateIcon.classList.add('spinning');
                generateText.textContent = 'G√©n√©ration en cours... (3 IA en parall√®le)';
                generateBtn.disabled = true;
                generateProgress.classList.remove('hidden');
            } else {
                generateIcon.textContent = '‚ú®';
                generateIcon.classList.remove('spinning');
                generateText.textContent = 'G√©n√©rer avec 3 IA';
                generateBtn.disabled = false;
                generateProgress.classList.add('hidden');
            }
        }

        function showGenerateError(message) {
            generateError.textContent = message;
            generateError.classList.remove('hidden');
        }

        function hideGenerateError() {
            generateError.classList.add('hidden');
        }

        function loadHistory() {
            // Load from localStorage
            const saved = localStorage.getItem(`history_${currentUser.uid}`);
            if (saved) {
                try {
                    generationHistory = JSON.parse(saved);
                } catch (e) {
                    generationHistory = [];
                }
            }
            updateHistory();
        }

        function updateHistory() {
            // Save to localStorage
            localStorage.setItem(`history_${currentUser.uid}`, JSON.stringify(generationHistory));

            // Update sidebar
            sidebarHistory.innerHTML = '';
            generationHistory.slice(0, 10).forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-sidebar-item';
                div.onclick = () => switchView('history');
                div.innerHTML = `
                    <div class="history-sidebar-title">${item.prompt}</div>
                    <div class="history-sidebar-date">${new Date(item.timestamp).toLocaleDateString()}</div>
                `;
                sidebarHistory.appendChild(div);
            });

            // Update main history
            if (generationHistory.length === 0) {
                historyContent.innerHTML = '';
                emptyHistory.classList.remove('hidden');
            } else {
                emptyHistory.classList.add('hidden');
                
                historyContent.innerHTML = '';
                generationHistory.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'history-item';
                    div.innerHTML = `
                        <div class="history-header">
                            <h3 class="history-title">${item.prompt}</h3>
                            <p class="history-date">${new Date(item.timestamp).toLocaleDateString()} √† ${new Date(item.timestamp).toLocaleTimeString()}</p>
                        </div>
                        <div class="image-grid">
                            <div class="image-card">
                                <div class="image-label">
                                    <div class="status-dot status-dalle"></div>
                                    DALL-E 3
                                </div>
                                <img src="${item.dalle_url}" alt="DALL-E generation" class="image-preview" onclick="openModal('${item.dalle_url}')">
                            </div>
                            <div class="image-card">
                                <div class="image-label">
                                    <div class="status-dot status-stable"></div>
                                    Stable Diffusion XL
                                </div>
                                <img src="${item.stable_url}" alt="Stable Diffusion generation" class="image-preview" onclick="openModal('${item.stable_url}')">
                            </div>
                            <div class="image-card">
                                <div class="image-label">
                                    <div class="status-dot status-midjourney"></div>
                                    Midjourney
                                </div>
                                <img src="${item.midjourney_url}" alt="Midjourney generation" class="image-preview" onclick="openModal('${item.midjourney_url}')">
                            </div>
                        </div>
                    `;
                    historyContent.appendChild(div);
                });
            }
        }

        function openModal(imageSrc) {
            modalImage.src = imageSrc;
            imageModal.classList.remove('hidden');
        }

        function handleLogout() {
            currentUser = null;
            generationHistory = [];
            authPage.classList.remove('hidden');
            mainApp.classList.add('hidden');
            emailInput.value = '';
            passwordInput.value = '';
            promptInput.value = '';
            switchView('generate');
        }
    </script>
</body>
</html>
